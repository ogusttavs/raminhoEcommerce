<style>
  .categories-section {
    padding: 5rem 0;
    background-color: var(--color-background);
  }

  .categories-section-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .categories-section-title {
    font-size: 2.4rem;
    color: var(--color-primary-dark);
    margin-bottom: 0.5rem;
  }

  .categories-section-subtitle {
    font-size: 1.05rem;
    opacity: 0.6;
  }

  .categories-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .categories-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .category-card {
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    aspect-ratio: 4 / 5;
    cursor: pointer;
    text-decoration: none;
    display: block;
  }

  .category-card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
  }

  .category-card:hover .category-card-image {
    transform: scale(1.06);
  }

  .category-card-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(7, 61, 36, 0.8) 0%, rgba(7, 61, 36, 0.1) 50%, transparent 100%);
    transition: background 0.4s ease;
  }

  .category-card:hover .category-card-overlay {
    background: linear-gradient(to top, rgba(7, 61, 36, 0.9) 0%, rgba(7, 61, 36, 0.2) 60%, transparent 100%);
  }

  .category-card-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 2rem;
    color: #fff;
    transform: translateY(0);
    transition: transform 0.4s ease;
  }

  .category-card:hover .category-card-content {
    transform: translateY(-8px);
  }

  .category-card-title {
    font-size: 1.6rem;
    margin-bottom: 0.3rem;
    line-height: 1.2;
  }

  .category-card-count {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  .category-card-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 1rem;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.4s ease;
  }

  .category-card:hover .category-card-cta {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<section class="categories-section">
  <div class="container">
    <div class="categories-section-header">
      <h2 class="categories-section-title font-heading">{{ section.settings.title }}</h2>
      <p class="categories-section-subtitle font-body">{{ section.settings.subtitle }}</p>
    </div>

    <div class="categories-grid">
      {% for block in section.blocks %}
        {% assign collection = collections[block.settings.collection] %}
        <a href="{{ collection.url | default: '#' }}" class="category-card" {{ block.shopify_attributes }}>
          {% if block.settings.image != blank %}
            <img src="{{ block.settings.image | image_url: width: 800 }}"
                 alt="{{ block.settings.heading | escape }}"
                 class="category-card-image"
                 loading="lazy"
                 width="800" height="1000">
          {% elsif collection != blank and collection.image != blank %}
            <img src="{{ collection.image | image_url: width: 800 }}"
                 alt="{{ collection.title | escape }}"
                 class="category-card-image"
                 loading="lazy"
                 width="800" height="1000">
          {% else %}
            <div class="category-card-image" style="background: linear-gradient(135deg, var(--color-primary-dark), var(--color-primary));"></div>
          {% endif %}

          <div class="category-card-overlay"></div>

          <div class="category-card-content">
            <h3 class="category-card-title font-heading">{{ block.settings.heading | default: collection.title | default: 'Categoria' }}</h3>
            {% if collection != blank %}
              <span class="category-card-count font-body">{{ collection.products_count }} produtos</span>
            {% endif %}
            <div class="category-card-cta font-body">
              Explorar
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Grid de Categorias",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título",
      "default": "Explore Nossa Seleção"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtítulo",
      "default": "Do campo à sua mesa, com curadoria artesanal."
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Categoria",
      "limit": 4,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Título do Card"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Coleção"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagem (Opcional, usa a da coleção se vazio)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Grid de Categorias",
      "blocks": [
        { "type": "category", "settings": { "heading": "Frutas Importadas" } },
        { "type": "category", "settings": { "heading": "Verduras & Legumes" } },
        { "type": "category", "settings": { "heading": "Empório Premium" } }
      ]
    }
  ]
}
{% endschema %}
