{% comment %}
  Header Premium Sticky
  - Fundo transparente ou sólido dependendo do scroll (animado no CSS)
  - Logo centralizado
  - Ícones minimalistas (Busca, User, Cart)
{% endcomment %}

{{ 'header.css' | asset_url | stylesheet_tag }}

<header class="header-premium" id="SiteHeader">
  <div class="container header-inner flex justify-between items-center">
    
    <!-- Esquerda: Menu Hamburger (Mobile) & Busca -->
    <div class="header-left flex items-center">
      <button class="header-icon-btn hidden-desktop" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <button class="header-icon-btn hidden-mobile" aria-label="Buscar" onclick="openSearch()">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      </button>
    </div>

    <!-- Centro: Logo -->
    <div class="header-center">
      <a href="{{ routes.root_url }}" class="header-logo">
        {% if section.settings.logo != blank %}
          <img src="{{ section.settings.logo | image_url: width: 300 }}" 
               alt="{{ shop.name }}" 
               width="{{ section.settings.logo_width }}" 
               height="auto" 
               loading="eager">
        {% else %}
          <img src="{{ 'logo_raminho_oficial.svg' | asset_url }}" 
               alt="{{ shop.name }}" 
               width="{{ section.settings.logo_width | default: 130 }}" 
               height="auto" 
               loading="eager"
               style="border-radius: 4px;">
        {% endif %}
      </a>
    </div>

    <!-- Direita: Conta & Carrinho -->
    <div class="header-right flex items-center">
      <a href="{{ routes.account_url }}" class="header-icon-btn hidden-mobile" aria-label="Conta">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      </a>
      <a href="{{ routes.cart_url }}" class="header-icon-btn cart-btn" aria-label="Carrinho">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
        {% if cart.item_count > 0 %}
          <span class="cart-count">{{ cart.item_count }}</span>
        {% endif %}
      </a>
    </div>
  </div>

  <!-- Search Drawer -->
  <div id="SearchDrawer" class="search-drawer">
    <div class="search-drawer-inner">
      <div class="container">
        <div class="search-drawer-header flex justify-between items-center">
          <h2 class="font-heading">O que você procura?</h2>
          <button class="header-icon-btn" onclick="closeSearch()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 6 6 18M6 6l12 12"/></svg>
          </button>
        </div>
        
        <form action="{{ routes.search_url }}" method="get" role="search" class="search-drawer-form">
          <div class="search-input-wrapper">
            <input type="text" 
                   name="q" 
                   placeholder="Pesquise por frutas, cestas ou especiarias..." 
                   class="search-drawer-input"
                   id="SearchDrawerInput"
                   autocomplete="off"
                   oninput="handleSearchInput(this.value)">
            <button type="submit" class="search-submit-btn">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            </button>
          </div>
          <div id="PredictiveSearchResults" class="predictive-search-results-container"></div>
        </form>
      </div>
    </div>
    <div class="search-drawer-overlay" onclick="closeSearch()"></div>
  </div>
</header>

<script>
  // Header Logic
  document.addEventListener('DOMContentLoaded', () => {
    const header = document.getElementById('SiteHeader');
    let lastScrollY = window.scrollY;

    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        header.classList.add('is-sticky');
        if (window.scrollY > lastScrollY) {
          header.classList.add('is-hidden');
        } else {
          header.classList.remove('is-hidden');
        }
      } else {
        header.classList.remove('is-sticky');
        header.classList.remove('is-hidden');
      }
      lastScrollY = window.scrollY;
    }, { passive: true });
  });

  // Search Toggle
  function openSearch() {
    const drawer = document.getElementById('SearchDrawer');
    drawer.classList.add('is-active');
    document.body.style.overflow = 'hidden';
    setTimeout(() => document.getElementById('SearchDrawerInput').focus(), 300);
  }

  function closeSearch() {
    const drawer = document.getElementById('SearchDrawer');
    drawer.classList.remove('is-active');
    document.body.style.overflow = '';
  }

  // Predictive Search Logic
  let searchTimeout;
  function handleSearchInput(query) {
    if (query.length < 3) {
      document.getElementById('PredictiveSearchResults').innerHTML = '';
      return;
    }

    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      fetch(`/search/suggest?q=${query}&resources[type]=product,collection&section_id=predictive-search`)
        .then(response => response.text())
        .then(text => {
          const results = new DOMParser().parseFromString(text, 'text/html').querySelector('#predictive-search-results');
          if (results) {
            document.getElementById('PredictiveSearchResults').innerHTML = results.innerHTML;
          }
        });
    }, 300);
  }
</script>

{% schema %}
{
  "name": "Header Premium",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Principal (Recomendado: Versão Dark ou Heritage)"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "Largura da Logo"
    }
  ]
}
{% endschema %}
